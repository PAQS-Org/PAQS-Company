import{d as i,N as a}from"./index.92c4a599.js";import{$axios as o}from"./axios.057661fc.js";var r={register:s=>o.post("account/company-register/",s),login:s=>o.post("account/company-login/",s),forgotPasswords:s=>o.post("account/company-request-reset-email/",s),setNewPasswords:s=>o.patch("/account/company-password-reset/",s),logout:s=>o.post("account/logout/",s),facebook:s=>o.post("socialLogin/facebook/",s),x:s=>o.post("socialLogin/twitter/",s),google:s=>o.post("socialLogin/google/",s),payment:s=>o.post("payment/initiate-payment/",s)};const l=i("global",{state:()=>({isMenuShown:!1,links:[{route:"Dash",label:"Dash"}]}),actions:{updateMenu(s){this.isMenuShown=s}}});l();const p=i("auth",{state:()=>({isLoading:!1,first_name:localStorage.getItem("first_name")||"",last_name:localStorage.getItem("last_name")||"",company_name:localStorage.getItem("company_name")||"",company_logo:localStorage.getItem("company_logo")||"",email:localStorage.getItem("email")||"",accessToken:localStorage.getItem("accessToken")||"",refreshToken:localStorage.getItem("refreshToken")||"",notif:localStorage.getItem("neverShowNotificationsBanner")||"",subsq:localStorage.getItem("subsq")||""}),getters:{isLoggedIn(s){return!!s.accessToken}},actions:{setAccessToken(s){this.accessToken=s,localStorage.setItem("accessToken",s)},saveUser(s,e){this.setAccessToken(s),this.first_name=e.first_name,this.last_name=e.last_name,this.company_name=e.company_name,this.company_logo=e.company_logo,this.email=e.email,localStorage.setItem("first_name",e.first_name),localStorage.setItem("last_name",e.last_name),localStorage.setItem("company_name",e.company_name),localStorage.setItem("company_logo",e.company_logo),localStorage.setItem("email",e.email)},removeUser(){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("company_name"),localStorage.removeItem("company_logo"),localStorage.removeItem("email"),localStorage.removeItem("first_name"),localStorage.removeItem("last_name"),this.accessToken="",this.refreshToken="",this.company_name="",this.company_logo="",this.email="",this.first_name="",this.last_name=""},async logins(s){try{const e=await r.login(s);if(e.status===200){const t="http://127.0.0.1:8000",n={company_name:e.data.company_name,company_logo:`${t}/images/${e.data.company_logo}`,first_name:e.data.first_name,last_name:e.data.last_name,email:e.data.email};this.saveUser(e.data.tokens.access,n),this.refreshToken=e.data.tokens.refresh,localStorage.setItem("refreshToken",this.refreshToken),a.create({type:"positive",message:"Login successful"}),this.router.push({path:"/dash/main"})}}catch(e){let t="An error occurred during login.";e.response&&e.response.data&&e.response.data.detail?t=e.response.data.detail:e.message&&(t=e.message),a.create({type:"negative",message:t})}},async register(s){this.isLoading=!0;try{(await r.register(s)).status===201&&(this.router.push({path:"/auth/verify"}),a.create({type:"positive",message:"Verify the email in your mail. Registration successful"}))}catch(e){let t="An error occurred during login.";e.response&&e.response.data&&e.response.data.detail?t=e.response.data.detail:e.message&&(t=e.message),a.create({type:"negative",message:t})}},async setNewPassword(s){this.isLoading=!0;try{(await r.setNewPasswords(s)).status==200&&(this.router.push({path:"/auth/login"}),a.create({type:"positive",message:"Password reset successful"}))}catch(e){let t="An error occurred during login.";e.response&&e.response.data&&e.response.data.detail?t=e.response.data.detail:e.message&&(t=e.message),a.create({type:"negative",message:t})}},async resetPassword(s){this.isLoading=!0;const e=await r.forgotPasswords(s);if(e.status==200){const t=e.data.split("/"),n=t[t.length-3],c=t[t.length-2];localStorage.setItem("uid64",n),localStorage.setItem("token",c),this.router.push({path:"/auth/resetPassword"}),a.create({type:"positive",message:"Proceed to your email to verify the action."})}},async logout(){this.isLoading=!0;try{const s=localStorage.getItem("refreshToken");(await r.logout({refresh_token:s})).status===204&&(this.removeUser(),this.router.push({name:"Login"})),a.create({type:"positive",message:"Logout successful"})}catch(s){let e="An error occurred during login.";s.response&&s.response.data&&s.response.data.detail?e=s.response.data.detail:s.message&&(e=s.message),a.create({type:"negative",message:e})}},async pushSubscribe(s){this.loading=!0;try{(await r.subscription(s)).status==201&&(this.router.push({path:"/"}),a.create({type:"positive",message:"Subscription successfully created"}))}catch(e){let t="An error occurred during login.";e.response&&e.response.data&&e.response.data.detail?t=e.response.data.detail:e.message&&(t=e.message),a.create({type:"negative",message:t})}}}});export{p as u};
